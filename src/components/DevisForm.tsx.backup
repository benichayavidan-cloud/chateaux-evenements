"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { motion, AnimatePresence } from "framer-motion";
import Image from "next/image";
import {
  Presentation,
  BookOpen,
  Sparkles,
  Users,
  Calendar,
  Clock,
  Building,
  User,
  Mail,
  Phone,
  Briefcase,
  MessageSquare,
  Check,
  ArrowRight,
  ArrowLeft,
} from "lucide-react";
import { chateaux } from "@/data/chateaux";
import type { DevisFormData, EventType, DureeEvent } from "@/types";

const formSchema = z.object({
  typeEvenement: z.enum([
    "seminaire",
    "journee-etude",
    "soiree-entreprise",
    "team-building",
    "autre",
  ]),
  datesSouhaitees: z.string().min(1, "Veuillez sélectionner une date"),
  duree: z.enum(["1-jour", "2-jours", "3-jours-plus"]),
  chateauIds: z.array(z.string()).min(1, "Veuillez sélectionner au moins un château"),
  entreprise: z.string().min(2, "Nom de l'entreprise requis"),
  nomPrenom: z.string().min(2, "Nom et prénom requis"),
  email: z.string().email("Email invalide"),
  telephoneMobile: z.string().min(10, "Numéro de téléphone invalide"),
  nombreParticipants: z.number().min(10).max(500),
  nombreChambres: z.number().min(1).max(400),
  plusDe500Participants: z.boolean().optional(),
  plusDe400Chambres: z.boolean().optional(),
  chambresTwin: z.boolean().optional(),
  budget: z.string().min(1, "Budget requis"),
  commentaireDeroulement: z.string().optional(),
  fichier: z.any().optional(),
});

type FormData = z.infer<typeof formSchema>;

const eventTypes = [
  {
    id: "seminaire" as EventType,
    label: "Séminaire Résidentiel",
    icon: Presentation,
  },
  {
    id: "journee-etude" as EventType,
    label: "Journée d'Étude",
    icon: BookOpen,
  },
  {
    id: "soiree-entreprise" as EventType,
    label: "Soirée d'Entreprise",
    icon: Sparkles,
  },
  { id: "team-building" as EventType, label: "Team Building", icon: Users },
  { id: "autre" as EventType, label: "Autre", icon: Briefcase },
];

const dureeOptions = [
  { value: "1-jour" as DureeEvent, label: "1 jour" },
  { value: "2-jours" as DureeEvent, label: "2 jours" },
  { value: "3-jours-plus" as DureeEvent, label: "3 jours ou plus" },
];

export function DevisForm() {
  const [currentStep, setCurrentStep] = useState(1);
  const [isSubmitted, setIsSubmitted] = useState(false);

  // Styles pour les sliders et file input
  const styleSheet = `
    .range-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #a37e2c;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(163, 126, 44, 0.4);
      transition: all 0.3s;
    }

    .range-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 4px 12px rgba(163, 126, 44, 0.6);
    }

    .range-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #a37e2c;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(163, 126, 44, 0.4);
      transition: all 0.3s;
    }

    .range-slider::-moz-range-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 4px 12px rgba(163, 126, 44, 0.6);
    }

    input[type="file"]::file-selector-button {
      color: #1f2937;
      font-weight: 600;
    }

    /* Changer tous les focus bleus en doré */
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    input[type="date"]:focus,
    input[type="file"]:focus,
    textarea:focus,
    input[type="checkbox"]:focus,
    input[type="range"]:focus,
    button:focus {
      outline: 2px solid #a37e2c !important;
      outline-offset: 2px;
      border-color: #a37e2c !important;
    }

    /* Checkbox accent doré */
    input[type="checkbox"]:checked {
      accent-color: #a37e2c;
    }

    /* Poignée de redimensionnement plus visible avec relief */
    textarea {
      resize: vertical;
      position: relative;
    }

    textarea::-webkit-resizer {
      background:
        linear-gradient(135deg, transparent 6px, #b8902f 6px, #b8902f 8px, transparent 8px),
        linear-gradient(135deg, transparent 10px, #c4a049 10px, #c4a049 12px, transparent 12px),
        linear-gradient(135deg, transparent 14px, #a37e2c 14px, #a37e2c 16px, transparent 16px);
      background-position: bottom right;
      background-repeat: no-repeat;
      filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.2));
    }
  `;

  const {
    register,
    handleSubmit,
    watch,
    setValue,
    getValues,
    formState: { errors },
    trigger,
  } = useForm<FormData>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      nombreParticipants: 50,
      nombreChambres: 10,
      plusDe500Participants: false,
      plusDe400Chambres: false,
      chambresTwin: false,
      chateauIds: [],
    },
  });

  const watchedValues = watch();

  const nextStep = async () => {
    let isValid = false;

    switch (currentStep) {
      case 1:
        isValid = await trigger("typeEvenement");
        break;
      case 2:
        isValid = await trigger(["datesSouhaitees", "duree"]);
        break;
      case 3:
        isValid = await trigger("chateauIds");
        break;
    }

    if (isValid) {
      setCurrentStep((prev) => Math.min(prev + 1, 4));
    }
  };

  const prevStep = () => {
    setCurrentStep((prev) => Math.max(prev - 1, 1));
  };

  const onSubmit = async (data: FormData) => {
    try {
      // Appeler l'API route au lieu d'insérer directement dans Supabase
      const response = await fetch('/api/devis', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (!response.ok) {
        alert(result.error || "Une erreur est survenue lors de l'envoi de votre demande. Veuillez réessayer.");
        return;
      }

      setIsSubmitted(true);
    } catch (error) {
      alert("Une erreur inattendue est survenue. Veuillez réessayer.");
    }
  };

  const progressPercentage = (currentStep / 4) * 100;

  if (isSubmitted) {
    return (
      <motion.div
        initial={{ opacity: 0, scale: 0.9 }}
        animate={{ opacity: 1, scale: 1 }}
        style={{
          maxWidth: "700px",
          margin: "0 auto",
          textAlign: "center",
          padding: "60px 20px"
        }}
      >
        <div style={{
          width: "80px",
          height: "80px",
          background: "#10b981",
          borderRadius: "50%",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          margin: "0 auto 24px"
        }}>
          <Check style={{ width: "40px", height: "40px", color: "white" }} />
        </div>
        <h2 style={{
          fontSize: "36px",
          fontWeight: "bold",
          marginBottom: "16px"
        }}>
          Demande envoyée avec succès !
        </h2>
        <p style={{
          fontSize: "18px",
          color: "#6b7280",
          marginBottom: "32px"
        }}>
          Merci pour votre demande. Notre équipe vous contactera dans les 24
          heures pour discuter de votre projet et établir un devis personnalisé.
        </p>
        <div style={{
          background: "#f3f4f6",
          borderRadius: "12px",
          padding: "24px"
        }}>
          <p style={{ color: "#6b7280" }}>
            <strong>Numéro de référence:</strong> #DEV
            {Math.random().toString(36).substr(2, 9).toUpperCase()}
          </p>
        </div>
      </motion.div>
    );
  }

  return (
    <>
      <style>{styleSheet}</style>
      <div style={{ maxWidth: "1000px", margin: "0 auto" }}>
        {/* Trust Section */}
        <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.6, ease: "easeOut" }}
        style={{
          background: "white",
          padding: "clamp(1rem, 3vw, 1.5rem)",
          marginBottom: "clamp(1.5rem, 4vw, 2.5rem)",
          borderRadius: "16px"
        }}
      >
        <div style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit, minmax(min(160px, 100%), 1fr))",
          gap: "clamp(1.5rem, 4vw, 2.5rem)",
          textAlign: "center"
        }}>
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.1, ease: "easeOut" }}
            whileHover={{ scale: 1.05 }}
          >
            <div style={{
              fontSize: "clamp(2rem, 6vw, 3rem)",
              fontWeight: "bold",
              color: "#a37e2c",
              marginBottom: "clamp(0.25rem, 1vw, 0.5rem)"
            }}>
              24h
            </div>
            <p style={{ color: "#6b7280", fontSize: "clamp(0.875rem, 2vw, 1rem)" }}>
              Réponse garantie sous 24 heures
            </p>
          </motion.div>
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.2, ease: "easeOut" }}
            whileHover={{ scale: 1.05 }}
          >
            <div style={{
              fontSize: "clamp(2rem, 6vw, 3rem)",
              fontWeight: "bold",
              color: "#a37e2c",
              marginBottom: "clamp(0.25rem, 1vw, 0.5rem)"
            }}>
              100%
            </div>
            <p style={{ color: "#6b7280", fontSize: "clamp(0.875rem, 2vw, 1rem)" }}>
              Devis personnalisé et sans engagement
            </p>
          </motion.div>
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.3, ease: "easeOut" }}
            whileHover={{ scale: 1.05 }}
          >
            <div style={{
              fontSize: "clamp(2rem, 6vw, 3rem)",
              fontWeight: "bold",
              color: "#a37e2c",
              marginBottom: "clamp(0.25rem, 1vw, 0.5rem)"
            }}>
              15+
            </div>
            <p style={{ color: "#6b7280", fontSize: "clamp(0.875rem, 2vw, 1rem)" }}>
              Années d'expertise événementielle
            </p>
          </motion.div>
        </div>
      </motion.div>

      {/* Progress Bar */}
      <div style={{ marginBottom: "clamp(1.5rem, 4vw, 2.5rem)" }}>
        <div style={{ display: "flex", alignItems: "center" }}>
          {[1, 2, 3, 4].map((step) => (
            <div
              key={step}
              style={{
                display: "flex",
                alignItems: "center",
                flex: step < 4 ? 1 : "0"
              }}
            >
              <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
                <div
                  style={{
                    width: "clamp(32px, 6vw, 40px)",
                    height: "clamp(32px, 6vw, 40px)",
                    borderRadius: "50%",
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "center",
                    fontWeight: "bold",
                    background: step === currentStep
                      ? "#a37e2c"
                      : step < currentStep
                      ? "#10b981"
                      : "#e5e7eb",
                    color: step > currentStep ? "#9ca3af" : "white",
                    transition: "all 0.3s",
                    marginBottom: "clamp(0.25rem, 1vw, 0.5rem)",
                    fontSize: "clamp(0.875rem, 2vw, 1rem)"
                  }}
                >
                  {step < currentStep ? <Check style={{ width: "clamp(16px, 3vw, 20px)", height: "clamp(16px, 3vw, 20px)" }} /> : step}
                </div>
                <span style={{
                  fontSize: "clamp(0.75rem, 2vw, 0.875rem)",
                  color: "#6b7280",
                  whiteSpace: "nowrap"
                }}>
                  {["Type", "Dates", "Château", "Formulaire"][step - 1]}
                </span>
              </div>
              {step < 4 && (
                <div style={{
                  flex: 1,
                  height: "8px",
                  margin: "0 8px",
                  background: "#e5e7eb",
                  borderRadius: "999px",
                  overflow: "hidden",
                  marginBottom: "28px"
                }}>
                  <div
                    style={{
                      height: "100%",
                      background: "#a37e2c",
                      transition: "width 0.3s",
                      width: step < currentStep ? "100%" : "0%"
                    }}
                  />
                </div>
              )}
            </div>
          ))}
        </div>
      </div>

      <form onSubmit={handleSubmit(onSubmit)}>
        <AnimatePresence mode="wait">
          {/* Étape 1: Type d'événement */}
          {currentStep === 1 && (
            <motion.div
              key="step1"
              initial={{ opacity: 0, x: 50 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -50 }}
              style={{ display: "flex", flexDirection: "column", gap: "24px" }}
            >
              <h3 style={{
                fontSize: "clamp(1.25rem, 4vw, 1.75rem)",
                fontWeight: "bold",
                marginBottom: "clamp(0.5rem, 2vw, 0.75rem)",
                color: "#1f2937"
              }}>
                Quel type d'événement souhaitez-vous organiser ?
              </h3>

              <div className="grid gap-4" style={{
                gridTemplateColumns: "repeat(auto-fit, minmax(min(100%, 160px), 1fr))"
              }}>
                {eventTypes.map((type) => {
                  const Icon = type.icon;
                  const isSelected = watchedValues.typeEvenement === type.id;
                  return (
                    <button
                      key={type.id}
                      type="button"
                      onClick={async () => {
                        setValue("typeEvenement", type.id);
                        // Auto-passage à l'étape suivante après 500ms
                        setTimeout(async () => {
                          const isValid = await trigger("typeEvenement");
                          if (isValid) {
                            setCurrentStep(2);
                          }
                        }, 500);
                      }}
                      style={{
                        padding: "24px",
                        borderRadius: "16px",
                        border: `2px solid ${isSelected ? "#a37e2c" : "#e5e7eb"}`,
                        background: isSelected ? "rgba(163, 126, 44, 0.05)" : "white",
                        cursor: "pointer",
                        transition: "all 0.3s",
                        textAlign: "left"
                      }}
                    >
                      <Icon style={{
                        width: "32px",
                        height: "32px",
                        color: "#a37e2c",
                        marginBottom: "12px"
                      }} />
                      <div style={{
                        fontWeight: "600",
                        fontSize: "16px",
                        color: "#1f2937"
                      }}>
                        {type.label}
                      </div>
                    </button>
                  );
                })}
              </div>
              {errors.typeEvenement && (
                <p style={{ color: "#ef4444", fontSize: "14px" }}>
                  {errors.typeEvenement.message}
                </p>
              )}
            </motion.div>
          )}

          {/* Étape 2: Dates et durée */}
          {currentStep === 2 && (
            <motion.div
              key="step2"
              initial={{ opacity: 0, x: 50 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -50 }}
              style={{ display: "flex", flexDirection: "column", gap: "24px" }}
            >
              <h3 style={{
                fontSize: "clamp(1.25rem, 4vw, 1.75rem)",
                fontWeight: "bold",
                marginBottom: "clamp(0.5rem, 2vw, 0.75rem)",
                color: "#1f2937"
              }}>
                Quand souhaitez-vous organiser votre événement ?
              </h3>

              {/* Dates souhaitées */}
              <div>
                <label style={{
                  display: "flex",
                  alignItems: "center",
                  gap: "8px",
                  fontSize: "14px",
                  fontWeight: "600",
                  marginBottom: "8px",
                  color: "#1f2937"
                }}>
                  <Calendar style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                  Date souhaitée *
                </label>
                <input
                  type="date"
                  {...register("datesSouhaitees")}
                  onChange={async (e) => {
                    setValue("datesSouhaitees", e.target.value);
                    // Auto-passage si date ET durée sont remplis
                    setTimeout(async () => {
                      const formValues = getValues();
                      const isValid = await trigger(["datesSouhaitees", "duree"]);
                      if (isValid && formValues.duree) {
                        setCurrentStep(3);
                      }
                    }, 500);
                  }}
                  style={{
                    width: "100%",
                    padding: "12px 16px",
                    border: "2px solid #e5e7eb",
                    borderRadius: "12px",
                    fontSize: "16px",
                    color: "#1f2937"
                  }}
                  min={new Date().toISOString().split("T")[0]}
                />
                {errors.datesSouhaitees && (
                  <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                    {errors.datesSouhaitees.message}
                  </p>
                )}
              </div>

              {/* Durée */}
              <div>
                <label style={{
                  display: "flex",
                  alignItems: "center",
                  gap: "8px",
                  fontSize: "14px",
                  fontWeight: "600",
                  marginBottom: "8px",
                  color: "#1f2937"
                }}>
                  <Clock style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                  Durée de l'événement *
                </label>
                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  {dureeOptions.map((option) => {
                    const isSelected = watchedValues.duree === option.value;
                    return (
                      <button
                        key={option.value}
                        type="button"
                        onClick={async () => {
                          setValue("duree", option.value);
                          // Auto-passage à l'étape suivante si date ET durée sont remplis
                          setTimeout(async () => {
                            const formValues = getValues();
                            const isValid = await trigger(["datesSouhaitees", "duree"]);
                            if (isValid && formValues.datesSouhaitees) {
                              setCurrentStep(3);
                            }
                          }, 500);
                        }}
                        style={{
                          padding: "12px 16px",
                          borderRadius: "12px",
                          border: `2px solid ${isSelected ? "#a37e2c" : "#e5e7eb"}`,
                          background: isSelected ? "rgba(163, 126, 44, 0.05)" : "white",
                          cursor: "pointer",
                          transition: "all 0.3s",
                          color: "#1f2937"
                        }}
                      >
                        {option.label}
                      </button>
                    );
                  })}
                </div>
                {errors.duree && (
                  <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                    {errors.duree.message}
                  </p>
                )}
              </div>
            </motion.div>
          )}

          {/* Étape 3: Sélection du château */}
          {currentStep === 3 && (
            <motion.div
              key="step3"
              initial={{ opacity: 0, x: 50 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -50 }}
              style={{ display: "flex", flexDirection: "column", gap: "24px" }}
            >
              <h3 style={{
                fontSize: "clamp(1.25rem, 4vw, 1.75rem)",
                fontWeight: "bold",
                marginBottom: "clamp(0.5rem, 2vw, 0.75rem)",
                color: "#1f2937"
              }}>
                Choisissez vos châteaux
              </h3>
              <p style={{ fontSize: "14px", color: "#6b7280", marginBottom: "16px" }}>
                Vous pouvez sélectionner plusieurs châteaux pour comparer les offres
              </p>

              <div className="grid gap-4" style={{
                gridTemplateColumns: "repeat(auto-fit, minmax(min(100%, 200px), 1fr))"
              }}>
                {chateaux.map((chateau) => {
                  const isSelected = watchedValues.chateauIds?.includes(chateau.id);
                  return (
                    <button
                      key={chateau.id}
                      type="button"
                      onClick={() => {
                        const currentIds = watchedValues.chateauIds || [];
                        if (isSelected) {
                          // Retirer si déjà sélectionné
                          setValue("chateauIds", currentIds.filter(id => id !== chateau.id));
                        } else {
                          // Ajouter à la sélection
                          setValue("chateauIds", [...currentIds, chateau.id]);
                        }
                      }}
                      style={{
                        textAlign: "left",
                        borderRadius: "16px",
                        border: `2px solid ${isSelected ? "#a37e2c" : "#e5e7eb"}`,
                        overflow: "hidden",
                        cursor: "pointer",
                        transition: "all 0.3s",
                        background: "white",
                        position: "relative"
                      }}
                    >
                      {isSelected && (
                        <div style={{
                          position: "absolute",
                          top: "12px",
                          right: "12px",
                          width: "32px",
                          height: "32px",
                          borderRadius: "50%",
                          background: "#a37e2c",
                          display: "flex",
                          alignItems: "center",
                          justifyContent: "center",
                          zIndex: 10
                        }}>
                          <Check style={{ width: "20px", height: "20px", color: "white" }} />
                        </div>
                      )}
                      <div style={{ position: "relative", height: "160px" }}>
                        <Image
                          src={chateau.images.card}
                          alt={chateau.nom}
                          fill
                          style={{ objectFit: "cover" }}
                        />
                      </div>
                      <div style={{ padding: "16px" }}>
                        <h4 style={{ fontWeight: "bold", marginBottom: "4px", color: "#1f2937" }}>
                          {chateau.nom}
                        </h4>
                        <p style={{ fontSize: "14px", color: "#6b7280" }}>
                          {chateau.region} • {chateau.capacite.min}-{chateau.capacite.max} pers.
                        </p>
                      </div>
                    </button>
                  );
                })}

                {/* Option "Laissez-nous vous conseiller" */}
                <button
                  type="button"
                  onClick={() => {
                    const currentIds = watchedValues.chateauIds || [];
                    const isSelected = currentIds.includes("conseil");
                    if (isSelected) {
                      setValue("chateauIds", currentIds.filter(id => id !== "conseil"));
                    } else {
                      setValue("chateauIds", [...currentIds, "conseil"]);
                    }
                  }}
                  style={{
                    padding: "24px",
                    borderRadius: "16px",
                    border: `2px dashed ${watchedValues.chateauIds?.includes("conseil") ? "#a37e2c" : "#d1d5db"}`,
                    background: watchedValues.chateauIds?.includes("conseil") ? "rgba(163, 126, 44, 0.05)" : "white",
                    cursor: "pointer",
                    transition: "all 0.3s",
                    display: "flex",
                    flexDirection: "column",
                    alignItems: "center",
                    justifyContent: "center",
                    textAlign: "center",
                    position: "relative"
                  }}
                >
                  {watchedValues.chateauIds?.includes("conseil") && (
                    <div style={{
                      position: "absolute",
                      top: "12px",
                      right: "12px",
                      width: "32px",
                      height: "32px",
                      borderRadius: "50%",
                      background: "#a37e2c",
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center"
                    }}>
                      <Check style={{ width: "20px", height: "20px", color: "white" }} />
                    </div>
                  )}
                  <Building style={{ width: "48px", height: "48px", color: "#a37e2c", marginBottom: "12px" }} />
                  <div style={{ fontWeight: "600", marginBottom: "8px", color: "#1f2937" }}>
                    Laissez-nous vous conseiller
                  </div>
                  <p style={{ fontSize: "14px", color: "#6b7280" }}>
                    Nos experts choisiront le château idéal pour votre événement
                  </p>
                </button>
              </div>
              {errors.chateauIds && (
                <p style={{ color: "#ef4444", fontSize: "14px" }}>
                  {errors.chateauIds.message}
                </p>
              )}
            </motion.div>
          )}

          {/* Étape 4: Informations de contact */}
          {currentStep === 4 && (
            <motion.div
              key="step4"
              initial={{ opacity: 0, x: 50 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -50 }}
              style={{ display: "flex", flexDirection: "column", gap: "24px" }}
            >
              <h3 style={{
                fontSize: "clamp(1.25rem, 4vw, 1.75rem)",
                fontWeight: "bold",
                marginBottom: "clamp(0.5rem, 2vw, 0.75rem)",
                color: "#1f2937"
              }}>
                Vos coordonnées et détails
              </h3>

              <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                {/* Entreprise */}
                <div>
                  <label style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "8px",
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    color: "#1f2937"
                  }}>
                    <Briefcase style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                    Entreprise *
                  </label>
                  <input
                    type="text"
                    {...register("entreprise")}
                    style={{
                      width: "100%",
                      padding: "12px 16px",
                      border: "2px solid #e5e7eb",
                      borderRadius: "12px",
                      fontSize: "16px",
                      color: "#1f2937"
                    }}
                    placeholder="Nom de votre entreprise"
                  />
                  {errors.entreprise && (
                    <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                      {errors.entreprise.message}
                    </p>
                  )}
                </div>

                {/* Nom Prénom */}
                <div>
                  <label style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "8px",
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    color: "#1f2937"
                  }}>
                    <User style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                    Nom Prénom *
                  </label>
                  <input
                    type="text"
                    {...register("nomPrenom")}
                    style={{
                      width: "100%",
                      padding: "12px 16px",
                      border: "2px solid #e5e7eb",
                      borderRadius: "12px",
                      fontSize: "16px",
                      color: "#1f2937"
                    }}
                    placeholder="Votre nom et prénom"
                  />
                  {errors.nomPrenom && (
                    <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                      {errors.nomPrenom.message}
                    </p>
                  )}
                </div>

                {/* Email */}
                <div>
                  <label style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "8px",
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    color: "#1f2937"
                  }}>
                    <Mail style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                    Email *
                  </label>
                  <input
                    type="email"
                    {...register("email")}
                    style={{
                      width: "100%",
                      padding: "12px 16px",
                      border: "2px solid #e5e7eb",
                      borderRadius: "12px",
                      fontSize: "16px",
                      color: "#1f2937"
                    }}
                    placeholder="votre.email@entreprise.com"
                  />
                  {errors.email && (
                    <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                      {errors.email.message}
                    </p>
                  )}
                </div>

                {/* Téléphone Mobile */}
                <div>
                  <label style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "8px",
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    color: "#1f2937"
                  }}>
                    <Phone style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                    Téléphone Mobile *
                  </label>
                  <input
                    type="tel"
                    {...register("telephoneMobile")}
                    style={{
                      width: "100%",
                      padding: "12px 16px",
                      border: "2px solid #e5e7eb",
                      borderRadius: "12px",
                      fontSize: "16px",
                      color: "#1f2937"
                    }}
                    placeholder="+33 6 12 34 56 78"
                  />
                  {errors.telephoneMobile && (
                    <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                      {errors.telephoneMobile.message}
                    </p>
                  )}
                </div>

                {/* Nombre de participants et chambres sur la même ligne */}
                <div style={{ gridColumn: "1 / -1", display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(min(200px, 100%), 1fr))", gap: "clamp(1rem, 3vw, 1.5rem)" }}>
                  {/* Nombre de participants */}
                  <div>
                    <label style={{
                      display: "flex",
                      alignItems: "center",
                      gap: "8px",
                      fontSize: "14px",
                      fontWeight: "600",
                      marginBottom: "8px",
                      color: "#1f2937"
                    }}>
                      <Users style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                      Nombre de participants: {watchedValues.nombreParticipants}
                    </label>
                    <input
                      type="range"
                      min="10"
                      max="500"
                      step="10"
                      {...register("nombreParticipants", { valueAsNumber: true })}
                      style={{
                        width: "100%",
                        height: "8px",
                        borderRadius: "999px",
                        cursor: "pointer",
                        WebkitAppearance: "none",
                        appearance: "none",
                        background: `linear-gradient(to right, #a37e2c 0%, #a37e2c ${((watchedValues.nombreParticipants - 10) / (500 - 10)) * 100}%, #e5e7eb ${((watchedValues.nombreParticipants - 10) / (500 - 10)) * 100}%, #e5e7eb 100%)`
                      }}
                      className="range-slider"
                    />
                    <div style={{ display: "flex", justifyContent: "space-between", fontSize: "12px", color: "#6b7280", marginTop: "4px" }}>
                      <span>10</span>
                      <span>500</span>
                    </div>
                    <label style={{
                      display: "flex",
                      alignItems: "center",
                      gap: "8px",
                      cursor: "pointer",
                      marginTop: "8px"
                    }}>
                      <input
                        type="checkbox"
                        {...register("plusDe500Participants")}
                        style={{
                          width: "18px",
                          height: "18px",
                          cursor: "pointer"
                        }}
                      />
                      <span style={{ fontSize: "13px", color: "#1f2937" }}>
                        Plus de 500 participants
                      </span>
                    </label>
                    {errors.nombreParticipants && (
                      <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                        {errors.nombreParticipants.message}
                      </p>
                    )}
                  </div>

                  {/* Nombre de chambres */}
                  <div>
                    <label style={{
                      fontSize: "14px",
                      fontWeight: "600",
                      marginBottom: "8px",
                      display: "block",
                      color: "#1f2937"
                    }}>
                      Nombre de chambres: {watchedValues.nombreChambres}
                    </label>
                    <input
                      type="range"
                      min="1"
                      max="400"
                      step="1"
                      {...register("nombreChambres", { valueAsNumber: true })}
                      style={{
                        width: "100%",
                        height: "8px",
                        borderRadius: "999px",
                        cursor: "pointer",
                        WebkitAppearance: "none",
                        appearance: "none",
                        background: `linear-gradient(to right, #a37e2c 0%, #a37e2c ${((watchedValues.nombreChambres - 1) / (400 - 1)) * 100}%, #e5e7eb ${((watchedValues.nombreChambres - 1) / (400 - 1)) * 100}%, #e5e7eb 100%)`
                      }}
                      className="range-slider"
                    />
                    <div style={{ display: "flex", justifyContent: "space-between", fontSize: "12px", color: "#6b7280", marginTop: "4px" }}>
                      <span>1</span>
                      <span>400</span>
                    </div>
                    <label style={{
                      display: "flex",
                      alignItems: "center",
                      gap: "8px",
                      cursor: "pointer",
                      marginTop: "8px"
                    }}>
                      <input
                        type="checkbox"
                        {...register("plusDe400Chambres")}
                        style={{
                          width: "18px",
                          height: "18px",
                          cursor: "pointer"
                        }}
                      />
                      <span style={{ fontSize: "13px", color: "#1f2937" }}>
                        Plus de 400 chambres
                      </span>
                    </label>
                    {errors.nombreChambres && (
                      <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                        {errors.nombreChambres.message}
                      </p>
                    )}
                  </div>
                </div>

                {/* Chambres Twin */}
                <div style={{ gridColumn: "1 / -1" }}>
                  <label style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "12px",
                    cursor: "pointer"
                  }}>
                    <input
                      type="checkbox"
                      {...register("chambresTwin")}
                      style={{
                        width: "20px",
                        height: "20px",
                        cursor: "pointer"
                      }}
                    />
                    <span style={{ fontSize: "14px", fontWeight: "600", color: "#1f2937" }}>
                      Possibilité de chambres twin
                    </span>
                  </label>
                </div>

                {/* Budget */}
                <div style={{ gridColumn: "1 / -1" }}>
                  <label style={{
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    display: "block",
                    color: "#1f2937"
                  }}>
                    Budget estimé *
                  </label>
                  <div style={{
                    display: "grid",
                    gridTemplateColumns: "repeat(auto-fit, minmax(140px, 1fr))",
                    gap: "12px"
                  }}>
                    {[
                      "< 10 000 €",
                      "10 000 - 25 000 €",
                      "25 000 - 50 000 €",
                      "50 000 - 100 000 €",
                      "> 100 000 €"
                    ].map((budgetOption) => {
                      const isSelected = watchedValues.budget === budgetOption;
                      return (
                        <button
                          key={budgetOption}
                          type="button"
                          onClick={() => setValue("budget", budgetOption)}
                          style={{
                            padding: "12px 16px",
                            borderRadius: "12px",
                            border: `2px solid ${isSelected ? "#a37e2c" : "#e5e7eb"}`,
                            background: isSelected ? "rgba(163, 126, 44, 0.1)" : "white",
                            cursor: "pointer",
                            transition: "all 0.3s",
                            fontSize: "14px",
                            fontWeight: isSelected ? "600" : "500",
                            color: isSelected ? "#a37e2c" : "#1f2937"
                          }}
                        >
                          {budgetOption}
                        </button>
                      );
                    })}
                  </div>
                  {errors.budget && (
                    <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                      {errors.budget.message}
                    </p>
                  )}
                </div>

                {/* Commentaire déroulement */}
                <div style={{ gridColumn: "1 / -1" }}>
                  <label style={{
                    display: "flex",
                    alignItems: "center",
                    gap: "8px",
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    color: "#1f2937"
                  }}>
                    <MessageSquare style={{ width: "16px", height: "16px", color: "#1f2937" }} />
                    Commentaire sur votre déroulé d'événement (optionnel)
                  </label>
                  <textarea
                    {...register("commentaireDeroulement")}
                    rows={6}
                    style={{
                      width: "100%",
                      padding: "12px 16px",
                      border: "2px solid #e5e7eb",
                      borderRadius: "12px",
                      fontSize: "16px",
                      resize: "vertical",
                      color: "#1f2937",
                      minHeight: "138px"
                    }}
                    placeholder="Décrivez le déroulement de votre événement, les activités prévues, les besoins spécifiques..."
                  />
                  {errors.commentaireDeroulement && (
                    <p style={{ color: "#ef4444", fontSize: "14px", marginTop: "4px" }}>
                      {errors.commentaireDeroulement.message}
                    </p>
                  )}
                </div>

                {/* Upload fichier */}
                <div style={{ gridColumn: "1 / -1" }}>
                  <label style={{
                    fontSize: "14px",
                    fontWeight: "600",
                    marginBottom: "8px",
                    display: "block",
                    color: "#1f2937"
                  }}>
                    Importer un fichier (PDF, Excel, Word) - Optionnel
                  </label>
                  <input
                    type="file"
                    accept=".pdf,.xlsx,.xls,.doc,.docx"
                    {...register("fichier")}
                    style={{
                      width: "100%",
                      padding: "12px 16px",
                      border: "2px solid #e5e7eb",
                      borderRadius: "12px",
                      fontSize: "16px",
                      color: "#1f2937"
                    }}
                  />
                  <p style={{ fontSize: "12px", color: "#6b7280", marginTop: "4px" }}>
                    Formats acceptés: PDF, Excel (.xlsx, .xls), Word (.doc, .docx)
                  </p>
                </div>
              </div>
            </motion.div>
          )}
        </AnimatePresence>

        {/* Navigation buttons */}
        <div style={{
          display: "flex",
          justifyContent: "space-between",
          marginTop: "clamp(1.5rem, 4vw, 2rem)",
          paddingTop: "clamp(1rem, 3vw, 1.5rem)",
          borderTop: "1px solid #e5e7eb",
          gap: "clamp(0.5rem, 2vw, 1rem)",
          flexWrap: "wrap"
        }}>
          {currentStep > 1 ? (
            <button
              type="button"
              onClick={prevStep}
              style={{
                display: "flex",
                alignItems: "center",
                gap: "clamp(0.25rem, 1vw, 0.5rem)",
                padding: "clamp(0.625rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem)",
                background: "#e5e7eb",
                color: "#1f2937",
                fontWeight: "600",
                borderRadius: "999px",
                border: "none",
                cursor: "pointer",
                transition: "all 0.3s",
                fontSize: "clamp(0.875rem, 2vw, 1rem)"
              }}
            >
              <ArrowLeft style={{ width: "20px", height: "20px" }} />
              Précédent
            </button>
          ) : (
            <div />
          )}

          {currentStep < 4 ? (
            <button
              type="button"
              onClick={nextStep}
              style={{
                display: "flex",
                alignItems: "center",
                gap: "clamp(0.25rem, 1vw, 0.5rem)",
                padding: "clamp(0.625rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem)",
                background: "#a37e2c",
                color: "white",
                fontWeight: "600",
                borderRadius: "999px",
                border: "none",
                cursor: "pointer",
                transition: "all 0.3s",
                boxShadow: "0 10px 15px -3px rgba(0, 0, 0, 0.1)",
                fontSize: "clamp(0.875rem, 2vw, 1rem)"
              }}
            >
              Suivant
              <ArrowRight style={{ width: "20px", height: "20px" }} />
            </button>
          ) : (
            <button
              type="submit"
              style={{
                display: "flex",
                alignItems: "center",
                gap: "clamp(0.25rem, 1vw, 0.5rem)",
                padding: "clamp(0.625rem, 2vw, 0.75rem) clamp(1.25rem, 4vw, 2rem)",
                background: "#a37e2c",
                color: "white",
                fontWeight: "600",
                borderRadius: "999px",
                border: "none",
                cursor: "pointer",
                transition: "all 0.3s",
                boxShadow: "0 10px 15px -3px rgba(0, 0, 0, 0.1)",
                fontSize: "clamp(0.875rem, 2vw, 1rem)"
              }}
            >
              Envoyer ma demande
              <Check style={{ width: "20px", height: "20px" }} />
            </button>
          )}
        </div>
      </form>
      </div>
    </>
  );
}
